<!doctype html>
<html lang="es">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Bingo Interactivo - Premio Morral con Cosmetiquera</title>
        <!-- Firebase SDK -->
        <script type="module">
            import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
            import {
                getDatabase,
                ref,
                set,
                get,
                onValue,
                remove,
            } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

            // Your web app's Firebase configuration
            const firebaseConfig = {
                apiKey: "AIzaSyCUvPrvvilavqv-JMWPDFFvxBU3uuGQX84",
                authDomain: "bingo-game-ab117.firebaseapp.com",
                databaseURL:
                    "https://bingo-game-ab117-default-rtdb.firebaseio.com",
                projectId: "bingo-game-ab117",
                storageBucket: "bingo-game-ab117.firebasestorage.app",
                messagingSenderId: "866584904558",
                appId: "1:866584904558:web:7241bfced821a92f43377f",
            };

            // Inicializar Firebase
            const app = initializeApp(firebaseConfig);
            const database = getDatabase(app);

            // Hacer las funciones disponibles globalmente
            window.firebaseDB = database;
            window.firebaseRef = ref;
            window.firebaseSet = set;
            window.firebaseGet = get;
            window.firebaseOnValue = onValue;
            window.firebaseRemove = remove;
            window.firebaseLoaded = true;

            // Inicializar el juego una vez que Firebase est√© listo
            document.addEventListener("DOMContentLoaded", function () {
                if (window.firebaseLoaded) {
                    initBingo();
                }
            });
        </script>

        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                color: #333;
                line-height: 1.6;
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
                background: white;
                border-radius: 20px;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
                overflow: hidden;
                margin: 10px;
            }

            .header {
                background: linear-gradient(135deg, #ff6b6b, #ee5a24);
                color: white;
                text-align: center;
                padding: 30px 20px;
            }

            .header h1 {
                font-size: 2.5em;
                margin-bottom: 10px;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            }

            .prize-info {
                text-align: center;
                padding: 20px;
                background: #f8f9fa;
            }

            .prize-images {
                display: flex;
                justify-content: center;
                gap: 15px;
                margin: 15px 0;
                flex-wrap: wrap;
            }

            .prize-image {
                width: 180px;
                height: 180px;
                object-fit: cover;
                border-radius: 15px;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            }

            .lottery-info {
                background: #e74c3c;
                color: white;
                text-align: center;
                padding: 12px;
                margin: 15px;
                border-radius: 10px;
                font-size: 1em;
                font-weight: bold;
            }

            .probability-selector {
                text-align: center;
                margin: 20px;
                padding: 0 15px;
            }

            .probability-selector h3 {
                margin-bottom: 15px;
                color: #2c3e50;
                font-size: 1.2em;
            }

            .prob-btn {
                background: linear-gradient(45deg, #3498db, #2980b9);
                color: white;
                border: none;
                padding: 12px 20px;
                margin: 8px;
                border-radius: 25px;
                cursor: pointer;
                font-size: 0.95em;
                transition: all 0.3s ease;
                display: inline-block;
                min-height: 48px;
                touch-action: manipulation;
            }

            .prob-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            }

            .prob-btn:active {
                transform: translateY(0);
            }

            .prob-btn.active {
                background: linear-gradient(45deg, #27ae60, #16a085);
            }

            .bingo-grid {
                display: grid;
                grid-template-columns: repeat(10, 1fr);
                gap: 6px;
                padding: 15px;
                max-width: 900px;
                margin: 0 auto;
                background: #f8f9fa;
                border-radius: 15px;
                margin: 20px auto;
                box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.1);
            }

            .number-cell {
                aspect-ratio: 1;
                border: 2px solid #ddd;
                border-radius: 8px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 1em;
                font-weight: bold;
                cursor: pointer;
                transition: all 0.2s ease;
                background: linear-gradient(135deg, #f8f9fa, #e9ecef);
                position: relative;
                min-height: 40px;
                touch-action: manipulation;
                user-select: none;
            }

            .number-cell:hover {
                transform: scale(1.08);
                border-color: #3498db;
                box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
                z-index: 2;
            }

            .number-cell:active {
                transform: scale(1.02);
            }

            .number-cell.taken {
                background: linear-gradient(135deg, #e74c3c, #c0392b);
                color: white;
                cursor: not-allowed;
                opacity: 0.9;
            }

            .number-cell.taken:hover {
                transform: none;
                box-shadow: none;
            }

            .number-cell.available {
                background: linear-gradient(135deg, #27ae60, #16a085);
                color: white;
                box-shadow: 0 2px 8px rgba(39, 174, 96, 0.3);
            }

            .number-cell small {
                position: absolute;
                bottom: 2px;
                left: 50%;
                transform: translateX(-50%);
                font-size: 0.6em;
                line-height: 1;
                text-align: center;
                width: 100%;
                padding: 0 2px;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }

            .modal {
                display: none;
                position: fixed;
                z-index: 1000;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.6);
                backdrop-filter: blur(2px);
            }

            .modal-content {
                background-color: white;
                margin: 5% auto;
                padding: 25px;
                border-radius: 15px;
                width: 95%;
                max-width: 450px;
                box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
                max-height: 90vh;
                overflow-y: auto;
            }

            .modal-content h3 {
                text-align: center;
                margin-bottom: 20px;
                color: #2c3e50;
            }

            .form-group {
                margin-bottom: 18px;
            }

            .form-group label {
                display: block;
                margin-bottom: 5px;
                font-weight: 600;
                color: #2c3e50;
                font-size: 0.95em;
            }

            .form-group input {
                width: 100%;
                padding: 12px;
                border: 2px solid #ddd;
                border-radius: 8px;
                font-size: 16px;
                transition: border-color 0.3s ease;
                background: #fafafa;
                box-sizing: border-box;
            }

            .form-group input:focus {
                outline: none;
                border-color: #3498db;
                background: white;
                box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
            }

            .form-group input.error {
                border-color: #e74c3c;
                background: #fdf2f2;
            }

            .form-group input.success {
                border-color: #27ae60;
                background: #f2f9f5;
            }

            .error-message {
                color: #e74c3c;
                font-size: 0.85em;
                margin-top: 5px;
                min-height: 1.2em;
            }

            .input-help {
                color: #7f8c8d;
                font-size: 0.8em;
                margin-top: 3px;
            }

            .sr-only {
                position: absolute;
                width: 1px;
                height: 1px;
                padding: 0;
                margin: -1px;
                overflow: hidden;
                clip: rect(0, 0, 0, 0);
                white-space: nowrap;
                border: 0;
            }

            .btn {
                background: linear-gradient(45deg, #3498db, #2980b9);
                color: white;
                border: none;
                padding: 12px 20px;
                border-radius: 8px;
                cursor: pointer;
                font-size: 1em;
                margin: 5px;
                transition: all 0.3s ease;
                min-height: 48px;
                touch-action: manipulation;
                font-weight: 600;
            }

            .btn:hover {
                transform: translateY(-1px);
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            }

            .btn:active {
                transform: translateY(0);
            }

            .btn-cancel {
                background: linear-gradient(45deg, #95a5a6, #7f8c8d);
            }

            .participants-list {
                margin: 15px;
                padding: 15px;
                background: #f8f9fa;
                border-radius: 10px;
                max-height: 400px;
                overflow-y: auto;
            }

            .participants-list h3 {
                text-align: center;
                margin-bottom: 15px;
                color: #2c3e50;
            }

            .participant-item {
                background: white;
                padding: 12px;
                margin: 8px 0;
                border-radius: 8px;
                border-left: 4px solid #3498db;
                font-size: 0.9em;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            }

            .stats {
                display: flex;
                justify-content: space-around;
                background: linear-gradient(135deg, #2c3e50, #34495e);
                color: white;
                padding: 20px;
                flex-wrap: wrap;
                gap: 10px;
            }

            .stat-item {
                text-align: center;
                flex: 1;
                min-width: 100px;
            }

            .stat-number {
                font-size: 1.8em;
                font-weight: bold;
                margin-bottom: 5px;
                display: block;
            }

            .stat-item div:last-child {
                font-size: 0.9em;
                opacity: 0.9;
            }

            /* Responsive Design */
            @media (max-width: 1024px) {
                .container {
                    margin: 5px;
                    border-radius: 15px;
                }

                .prize-image {
                    width: 160px;
                    height: 160px;
                }

                .bingo-grid {
                    max-width: 100%;
                    padding: 10px;
                }
            }

            @media (max-width: 768px) {
                .bingo-grid {
                    grid-template-columns: repeat(8, 1fr);
                    gap: 4px;
                    padding: 10px;
                    margin: 15px 10px;
                }

                .number-cell {
                    font-size: 0.9em;
                    min-height: 35px;
                    border-width: 1px;
                }

                .number-cell small {
                    font-size: 0.55em;
                }

                .header {
                    padding: 20px 15px;
                }

                .header h1 {
                    font-size: 2em;
                }

                .prize-images {
                    flex-direction: column;
                    align-items: center;
                    gap: 10px;
                }

                .prize-image {
                    width: 140px;
                    height: 140px;
                }

                .lottery-info {
                    margin: 10px;
                    padding: 10px;
                    font-size: 0.9em;
                }

                .probability-selector {
                    margin: 15px 10px;
                }

                .prob-btn {
                    display: block;
                    width: 100%;
                    margin: 10px 0;
                    padding: 15px;
                    font-size: 1em;
                }

                .stats {
                    padding: 15px 10px;
                    gap: 15px;
                }

                .stat-number {
                    font-size: 1.5em;
                }

                .modal-content {
                    margin: 10% auto;
                    padding: 20px;
                    width: 98%;
                }

                .participants-list {
                    margin: 10px;
                    padding: 10px;
                    max-height: 300px;
                }

                .participant-item {
                    padding: 10px;
                    font-size: 0.85em;
                }
            }

            @media (max-width: 480px) {
                .container {
                    margin: 2px;
                    border-radius: 10px;
                }

                .bingo-grid {
                    grid-template-columns: repeat(6, 1fr);
                    gap: 3px;
                    padding: 8px;
                    margin: 10px 5px;
                }

                .number-cell {
                    font-size: 0.8em;
                    min-height: 32px;
                    border-radius: 6px;
                }

                .number-cell small {
                    font-size: 0.5em;
                    bottom: 1px;
                }

                .header h1 {
                    font-size: 1.6em;
                }

                .prize-image {
                    width: 120px;
                    height: 120px;
                }

                .stats {
                    flex-direction: column;
                    gap: 10px;
                }

                .stat-item {
                    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
                    padding-bottom: 10px;
                }

                .stat-item:last-child {
                    border-bottom: none;
                    padding-bottom: 0;
                }

                .modal-content {
                    margin: 5% auto;
                    padding: 15px;
                    border-radius: 10px;
                }

                .form-group input {
                    padding: 15px;
                    font-size: 16px;
                }
            }

            @media (max-width: 360px) {
                .bingo-grid {
                    grid-template-columns: repeat(5, 1fr);
                    gap: 2px;
                    padding: 6px;
                }

                .number-cell {
                    font-size: 0.75em;
                    min-height: 30px;
                }

                .header h1 {
                    font-size: 1.4em;
                }
            }

            /* Mejoras de accesibilidad y UX */
            @media (hover: none) and (pointer: coarse) {
                .number-cell:hover {
                    transform: none;
                }

                .btn:hover,
                .prob-btn:hover {
                    transform: none;
                }
            }

            /* Animaciones suaves */
            .number-cell.just-added {
                animation: cellAdded 0.5s ease-out;
            }

            @keyframes cellAdded {
                0% {
                    transform: scale(0.8);
                    opacity: 0.5;
                }
                50% {
                    transform: scale(1.1);
                }
                100% {
                    transform: scale(1);
                    opacity: 1;
                }
            }

            /* Estados de carga */
            .loading {
                opacity: 0.6;
                pointer-events: none;
            }

            .loading::after {
                content: "";
                position: absolute;
                top: 50%;
                left: 50%;
                width: 20px;
                height: 20px;
                margin: -10px 0 0 -10px;
                border: 2px solid transparent;
                border-top: 2px solid #3498db;
                border-radius: 50%;
                animation: spin 1s linear infinite;
            }

            @keyframes spin {
                0% {
                    transform: rotate(0deg);
                }
                100% {
                    transform: rotate(360deg);
                }
            }

            @keyframes slideIn {
                0% {
                    transform: translateX(100%);
                    opacity: 0;
                }
                100% {
                    transform: translateX(0);
                    opacity: 1;
                }
            }

            @keyframes slideOut {
                0% {
                    transform: translateX(0);
                    opacity: 1;
                }
                100% {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }

            /* Estilos adicionales para mejor UX m√≥vil */
            .btn,
            .prob-btn,
            .number-cell {
                -webkit-tap-highlight-color: transparent;
                -webkit-touch-callout: none;
                -webkit-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
            }

            /* Mejora para inputs en iOS */
            input[type="text"],
            input[type="tel"] {
                -webkit-appearance: none;
                -webkit-border-radius: 0;
            }

            /* Estilos para el estado loading del grid */
            .bingo-grid.loading {
                position: relative;
            }

            .bingo-grid.loading .number-cell {
                opacity: 0.7;
                pointer-events: none;
            }

            /* Pulse animation para el bot√≥n activo */
            .prob-btn.active {
                animation: pulse 2s infinite;
            }

            @keyframes pulse {
                0% {
                    box-shadow: 0 0 0 0 rgba(39, 174, 96, 0.7);
                }
                70% {
                    box-shadow: 0 0 0 10px rgba(39, 174, 96, 0);
                }
                100% {
                    box-shadow: 0 0 0 0 rgba(39, 174, 96, 0);
                }
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>üéâ BINGO INTERACTIVO üéâ</h1>
                <p>¬°Participa y gana incre√≠bles premios!</p>
            </div>

            <div class="prize-info">
                <h2
                    style="
                        text-align: center;
                        color: #e74c3c;
                        margin-bottom: 20px;
                    "
                >
                    üèÜ GRAN PREMIO üèÜ
                </h2>
                <div class="prize-images">
                    <div style="text-align: center">
                        <h3>Morral Elegante</h3>
                        <div
                            style="
                                width: 200px;
                                height: 200px;
                                background: linear-gradient(
                                    135deg,
                                    #8b4513,
                                    #d2691e
                                );
                                border-radius: 15px;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                color: white;
                                font-size: 1.2em;
                                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
                            "
                        >
                            Morral con<br />Detalles Leopardo
                        </div>
                    </div>
                    <div style="text-align: center">
                        <h3>Cosmetiquera</h3>
                        <div
                            style="
                                width: 200px;
                                height: 200px;
                                background: linear-gradient(
                                    135deg,
                                    #cd853f,
                                    #f4a460
                                );
                                border-radius: 15px;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                color: white;
                                font-size: 1.2em;
                                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
                            "
                        >
                            Cosmetiquera<br />de Cuero
                        </div>
                    </div>
                </div>
                <h2
                    style="text-align: center; color: #27ae60; margin-top: 20px"
                >
                    üí∞ Valor: $10.000 COP üí∞
                </h2>
            </div>

            <div class="lottery-info">
                üóìÔ∏è FECHA: 2 de Octubre | üé≤ LOTER√çA SINUANO | üåô HORARIO:
                Nocturno
            </div>

            <div class="probability-selector">
                <h3>Selecciona tu modalidad de juego:</h3>
                <button
                    class="prob-btn active"
                    onclick="setProbability('normal')"
                >
                    üéØ Probabilidad Normal (1 oportunidad por n√∫mero)
                </button>
                <button class="prob-btn" onclick="setProbability('premium')">
                    ‚≠ê Probabilidad Premium (2 oportunidades por n√∫mero)
                </button>
                <button
                    class="btn btn-cancel"
                    onclick="resetBingo()"
                    style="margin-top: 10px; background-color: #e74c3c"
                >
                    üóëÔ∏è Resetear Bingo
                </button>
            </div>

            <div class="stats">
                <div class="stat-item">
                    <div class="stat-number" id="availableNumbers">50</div>
                    <div>N√∫meros Disponibles</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="totalParticipants">0</div>
                    <div>Participantes</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="totalTickets">0</div>
                    <div>Boletos Vendidos</div>
                </div>
            </div>

            <div class="bingo-grid" id="bingoGrid">
                <!-- Los n√∫meros se generar√°n con JavaScript -->
            </div>

            <div class="participants-list">
                <h3>üë• Lista de Participantes</h3>
                <div id="participantsList">
                    <p style="text-align: center; color: #7f8c8d">
                        No hay participantes a√∫n. ¬°S√© el primero en participar!
                    </p>
                </div>
            </div>
        </div>

        <!-- Modal para registro -->
        <div
            id="registrationModal"
            class="modal"
            role="dialog"
            aria-labelledby="modal-title"
            aria-hidden="true"
        >
            <div class="modal-content">
                <h3 id="modal-title">
                    üìù Registro para el N√∫mero <span id="selectedNumber"></span>
                </h3>
                <form id="registrationForm" novalidate>
                    <div class="form-group">
                        <label for="participantName">
                            Nombre Completo:
                            <span style="color: #e74c3c">*</span>
                        </label>
                        <input
                            type="text"
                            id="participantName"
                            required
                            autocomplete="name"
                            placeholder="Ingresa tu nombre completo"
                            aria-describedby="name-error"
                        />
                        <div
                            id="name-error"
                            class="error-message"
                            role="alert"
                        ></div>
                    </div>
                    <div class="form-group">
                        <label for="participantPhone">
                            N√∫mero de Celular:
                            <span style="color: #e74c3c">*</span>
                        </label>
                        <input
                            type="tel"
                            id="participantPhone"
                            required
                            pattern="[0-9]{10}"
                            autocomplete="tel"
                            placeholder="1234567890 (10 d√≠gitos)"
                            aria-describedby="phone-error phone-help"
                        />
                        <div id="phone-help" class="input-help">
                            Ingresa 10 d√≠gitos sin espacios ni guiones
                        </div>
                        <div
                            id="phone-error"
                            class="error-message"
                            role="alert"
                        ></div>
                    </div>
                    <div class="form-group">
                        <label>Modalidad Seleccionada:</label>
                        <div
                            id="selectedProbability"
                            style="
                                font-weight: bold;
                                color: #3498db;
                                padding: 10px;
                                background: #f8f9fa;
                                border-radius: 5px;
                                margin-top: 5px;
                            "
                        ></div>
                    </div>
                    <div style="text-align: center; margin-top: 25px">
                        <button type="submit" class="btn" id="submit-btn">
                            ‚úÖ Confirmar Registro
                        </button>
                        <button
                            type="button"
                            class="btn btn-cancel"
                            onclick="closeModal()"
                            aria-label="Cancelar registro y cerrar ventana"
                        >
                            ‚ùå Cancelar
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <script>
            let currentProbability = "normal";
            let participants = [];
            let selectedNumberForRegistration = null;

            // Funciones para manejo de Firebase
            function saveParticipant(participant) {
                if (!window.firebaseDB) {
                    console.warn("Firebase no disponible");
                    showNotification(
                        "Error: No hay conexi√≥n a la base de datos.",
                        "error",
                    );
                    return;
                }

                // Mostrar estado de carga
                const grid = document.getElementById("bingoGrid");
                grid.classList.add("loading");

                console.log("Guardando participante:", participant);
                const participantRef = window.firebaseRef(
                    window.firebaseDB,
                    `bingo/participants/${participant.number}`,
                );
                window
                    .firebaseSet(participantRef, participant)
                    .then(() => {
                        console.log("Participante guardado exitosamente");
                        grid.classList.remove("loading");

                        // Agregar animaci√≥n a la celda reci√©n agregada
                        const cell = document.querySelector(
                            `[data-number="${participant.number}"]`,
                        );
                        if (cell) {
                            cell.classList.add("just-added");
                            setTimeout(
                                () => cell.classList.remove("just-added"),
                                500,
                            );
                        }
                    })
                    .catch((error) => {
                        console.error("Error guardando en Firebase:", error);
                        grid.classList.remove("loading");
                        showNotification(
                            "Error al sincronizar los datos. Por favor intenta de nuevo.",
                            "error",
                        );
                    });
            }

            function loadParticipants() {
                if (!window.firebaseDB) {
                    console.warn("Firebase no disponible");
                    return;
                }

                const participantsRef = window.firebaseRef(
                    window.firebaseDB,
                    "bingo/participants",
                );

                // Escuchar cambios en tiempo real
                window.firebaseOnValue(participantsRef, (snapshot) => {
                    const data = snapshot.val();
                    console.log("Datos recibidos de Firebase:", data);
                    if (data) {
                        // Convertir objeto a array
                        participants = Object.values(data);
                    } else {
                        participants = [];
                    }
                    updateUI();
                });
            }

            function updateUI() {
                const grid = document.getElementById("bingoGrid");

                // Solo actualizar si el grid existe
                if (!grid) return;

                // Limpiar grid y restaurar n√∫meros disponibles
                for (let i = 1; i <= 50; i++) {
                    const cell = document.querySelector(`[data-number="${i}"]`);
                    if (cell) {
                        cell.className = "number-cell available";
                        cell.innerHTML = i;
                        cell.setAttribute(
                            "aria-label",
                            `N√∫mero ${i}, disponible`,
                        );
                        cell.style.cursor = "pointer";
                        cell.setAttribute("tabindex", "0");
                    }
                }

                // Restaurar n√∫meros ocupados
                participants.forEach((participant) => {
                    const cell = document.querySelector(
                        `[data-number="${participant.number}"]`,
                    );
                    if (cell) {
                        cell.classList.remove("available");
                        cell.classList.add("taken");
                        cell.innerHTML = `${participant.number}<br><small>${participant.name}</small>`;
                        cell.setAttribute(
                            "aria-label",
                            `N√∫mero ${participant.number}, ocupado por ${participant.name}`,
                        );
                        cell.style.cursor = "not-allowed";
                        cell.setAttribute("tabindex", "-1");
                    }
                });

                updateParticipantsList();
                updateStats();
            }

            // Funciones auxiliares para accesibilidad
            function announceToScreenReader(message) {
                const announcement = document.createElement("div");
                announcement.setAttribute("aria-live", "polite");
                announcement.setAttribute("aria-atomic", "true");
                announcement.className = "sr-only";
                announcement.textContent = message;
                document.body.appendChild(announcement);
                setTimeout(() => document.body.removeChild(announcement), 1000);
            }

            function showNotification(message, type = "info") {
                // Crear notificaci√≥n visual
                const notification = document.createElement("div");
                notification.className = `notification ${type}`;
                notification.textContent = message;
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: ${type === "error" ? "#e74c3c" : "#27ae60"};
                    color: white;
                    padding: 15px 20px;
                    border-radius: 5px;
                    z-index: 10000;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                    animation: slideIn 0.3s ease-out;
                `;

                document.body.appendChild(notification);
                setTimeout(() => {
                    notification.style.animation = "slideOut 0.3s ease-out";
                    setTimeout(
                        () => document.body.removeChild(notification),
                        300,
                    );
                }, 3000);

                // Tambi√©n anunciar a lectores de pantalla
                announceToScreenReader(message);
            }

            function clearFormErrors() {
                document.getElementById("name-error").textContent = "";
                document.getElementById("phone-error").textContent = "";

                // Limpiar clases de error/√©xito
                const nameInput = document.getElementById("participantName");
                const phoneInput = document.getElementById("participantPhone");

                nameInput.classList.remove("error", "success");
                phoneInput.classList.remove("error", "success");
            }

            // Inicializar el bingo
            function initBingo() {
                const grid = document.getElementById("bingoGrid");
                grid.innerHTML = "";

                for (let i = 1; i <= 50; i++) {
                    const cell = document.createElement("div");
                    cell.className = "number-cell available";
                    cell.textContent = i;
                    cell.setAttribute("data-number", i);
                    cell.setAttribute("role", "gridcell");
                    cell.setAttribute("tabindex", "0");
                    cell.setAttribute("aria-label", `N√∫mero ${i}, disponible`);
                    cell.onclick = () => selectNumber(i);
                    cell.onkeydown = (e) => {
                        if (e.key === "Enter" || e.key === " ") {
                            e.preventDefault();
                            selectNumber(i);
                        }
                    };
                    grid.appendChild(cell);
                }

                // Cargar y escuchar participantes de Firebase
                loadParticipants();
            }

            function setProbability(prob) {
                currentProbability = prob;
                document.querySelectorAll(".prob-btn").forEach((btn) => {
                    btn.classList.remove("active");
                    btn.setAttribute("aria-pressed", "false");
                });
                event.target.classList.add("active");
                event.target.setAttribute("aria-pressed", "true");

                // Anunciar cambio para lectores de pantalla
                const announcement =
                    prob === "normal"
                        ? "Modalidad Normal seleccionada: 1 oportunidad por n√∫mero"
                        : "Modalidad Premium seleccionada: 2 oportunidades por n√∫mero";
                announceToScreenReader(announcement);
            }

            function selectNumber(number) {
                const cell = document.querySelector(
                    `[data-number="${number}"]`,
                );

                // Verificar si ya est√° ocupado en el DOM
                if (cell.classList.contains("taken")) {
                    showNotification(
                        "¬°Este n√∫mero ya est√° ocupado! Por favor selecciona otro.",
                        "error",
                    );
                    return;
                }

                // Verificar si ya est√° ocupado en los datos locales
                const isNumberTaken = participants.some(
                    (p) => p.number === number,
                );
                if (isNumberTaken) {
                    showNotification(
                        "¬°Este n√∫mero ya est√° ocupado! Por favor selecciona otro.",
                        "error",
                    );
                    return;
                }

                selectedNumberForRegistration = number;
                document.getElementById("selectedNumber").textContent = number;
                document.getElementById("selectedProbability").innerHTML =
                    currentProbability === "normal"
                        ? "üéØ <strong>Probabilidad Normal</strong><br><small>1 oportunidad por n√∫mero</small>"
                        : "‚≠ê <strong>Probabilidad Premium</strong><br><small>2 oportunidades por n√∫mero</small>";

                const modal = document.getElementById("registrationModal");
                modal.style.display = "block";
                modal.setAttribute("aria-hidden", "false");

                // Enfocar el primer input
                setTimeout(() => {
                    document.getElementById("participantName").focus();
                }, 100);
            }

            function closeModal() {
                const modal = document.getElementById("registrationModal");
                modal.style.display = "none";
                modal.setAttribute("aria-hidden", "true");
                document.getElementById("registrationForm").reset();
                clearFormErrors();
                selectedNumberForRegistration = null;

                // Devolver foco al n√∫mero que se hab√≠a seleccionado
                if (selectedNumberForRegistration) {
                    const cell = document.querySelector(
                        `[data-number="${selectedNumberForRegistration}"]`,
                    );
                    if (cell) cell.focus();
                }
            }

            document.getElementById("registrationForm").onsubmit = function (
                e,
            ) {
                e.preventDefault();
                clearFormErrors();

                const nameInput = document.getElementById("participantName");
                const phoneInput = document.getElementById("participantPhone");
                const name = nameInput.value.trim();
                const phone = phoneInput.value.trim();
                let hasErrors = false;

                // Validaci√≥n del nombre
                if (!name) {
                    showFieldError(
                        "name-error",
                        "Por favor ingresa tu nombre.",
                    );
                    nameInput.classList.add("error");
                    hasErrors = true;
                } else if (name.length < 2) {
                    showFieldError(
                        "name-error",
                        "El nombre debe tener al menos 2 caracteres.",
                    );
                    nameInput.classList.add("error");
                    hasErrors = true;
                } else {
                    nameInput.classList.remove("error");
                    nameInput.classList.add("success");
                }

                // Validaci√≥n del tel√©fono
                if (!phone) {
                    showFieldError(
                        "phone-error",
                        "Por favor ingresa tu tel√©fono.",
                    );
                    phoneInput.classList.add("error");
                    hasErrors = true;
                } else {
                    const phoneRegex = /^[0-9]{10}$/;
                    if (!phoneRegex.test(phone)) {
                        showFieldError(
                            "phone-error",
                            "Ingresa un n√∫mero v√°lido de 10 d√≠gitos.",
                        );
                        phoneInput.classList.add("error");
                        hasErrors = true;
                    } else {
                        phoneInput.classList.remove("error");
                        phoneInput.classList.add("success");
                    }
                }

                if (hasErrors) {
                    return;
                }

                // Verificar una vez m√°s que el n√∫mero sigue disponible
                const isStillAvailable = !participants.some(
                    (p) => p.number === selectedNumberForRegistration,
                );
                if (!isStillAvailable) {
                    showNotification(
                        "¬°Lo siento! Este n√∫mero acaba de ser seleccionado por otro usuario. Por favor selecciona otro n√∫mero.",
                        "error",
                    );
                    closeModal();
                    return;
                }

                // Deshabilitar bot√≥n durante el procesamiento
                const submitBtn = document.getElementById("submit-btn");
                submitBtn.disabled = true;
                submitBtn.textContent = "‚è≥ Procesando...";

                // Registrar participante
                const participant = {
                    number: selectedNumberForRegistration,
                    name: name,
                    phone: phone,
                    probability: currentProbability,
                    timestamp: new Date().toLocaleString(),
                };

                // Guardar en Firebase individualmente
                saveParticipant(participant);

                closeModal();

                // Rehabilitar bot√≥n
                submitBtn.disabled = false;
                submitBtn.textContent = "‚úÖ Confirmar Registro";

                showNotification(
                    `¬°Registro exitoso! ${name}, has seleccionado el n√∫mero ${selectedNumberForRegistration} con ${currentProbability === "normal" ? "1 oportunidad" : "2 oportunidades"}.`,
                    "success",
                );
            };

            function showFieldError(elementId, message) {
                document.getElementById(elementId).textContent = message;
            }

            function updateParticipantsList() {
                const list = document.getElementById("participantsList");

                if (participants.length === 0) {
                    list.innerHTML =
                        '<p style="text-align: center; color: #7f8c8d;">No hay participantes a√∫n. ¬°S√© el primero en participar!</p>';
                    return;
                }

                list.innerHTML = participants
                    .sort((a, b) => a.number - b.number)
                    .map(
                        (p) => `
                    <div class="participant-item">
                        <strong>N√∫mero ${p.number}</strong> - ${p.name}<br>
                        üì± ${p.phone} | ${p.probability === "normal" ? "üéØ Normal" : "‚≠ê Premium"}<br>
                        <small>Registrado: ${p.timestamp}</small>
                    </div>
                `,
                    )
                    .join("");
            }

            function updateStats() {
                const available = 50 - participants.length;
                const totalTickets = participants.reduce(
                    (sum, p) => sum + (p.probability === "premium" ? 2 : 1),
                    0,
                );

                document.getElementById("availableNumbers").textContent =
                    available;
                document.getElementById("totalParticipants").textContent =
                    participants.length;
                document.getElementById("totalTickets").textContent =
                    totalTickets;
            }

            function resetBingo() {
                if (
                    confirm(
                        "¬øEst√°s seguro de que quieres resetear el bingo? Se perder√°n todos los participantes registrados para TODOS los usuarios.",
                    )
                ) {
                    const participantsRef = window.firebaseRef(
                        window.firebaseDB,
                        "bingo/participants",
                    );
                    window
                        .firebaseRemove(participantsRef)
                        .then(() => {
                            alert(
                                "¬°Bingo reseteado exitosamente para todos los usuarios!",
                            );
                        })
                        .catch((error) => {
                            console.error("Error reseteando Firebase:", error);
                            alert(
                                "Error al resetear el bingo. Por favor intenta de nuevo.",
                            );
                        });
                }
            }

            // Cerrar modal al hacer clic fuera de √©l
            window.onclick = function (event) {
                const modal = document.getElementById("registrationModal");
                if (event.target === modal) {
                    closeModal();
                }
            };

            // Inicializar el juego solo si Firebase no est√° disponible (fallback)
            document.addEventListener("DOMContentLoaded", function () {
                if (!window.firebaseLoaded) {
                    console.warn(
                        "Firebase no est√° disponible, iniciando en modo local",
                    );
                    initBingo();
                }
            });
        </script>
    </body>
</html>
<script>
    // Update the prize images section to use actual images
    document.addEventListener("DOMContentLoaded", function () {
        const prizeImagesDiv = document.querySelector(".prize-images");
        prizeImagesDiv.innerHTML = `
            <div style="text-align: center;">
                <h3>Morral Elegante con Detalles Leopardo</h3>
                <img src="morral.png"
                     alt="Morral con detalles leopardo"
                     class="prize-image"
                     style="width: 250px; height: 250px; object-fit: cover; border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.3); border: 3px solid #D2691E;">
            </div>
            <div style="text-align: center;">
                <h3>Cosmetiquera de Cuero</h3>
                <img src="cosmetiquera.png"
                     alt="Cosmetiquera de cuero"
                     class="prize-image"
                     style="width: 250px; height: 250px; object-fit: cover; border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.3); border: 3px solid #CD853F;">
            </div>
        `;

        // Remove normal probability option and set premium as default
        const probabilitySelector = document.querySelector(
            ".probability-selector",
        );
        probabilitySelector.innerHTML = `
            <h3 style="color: #e74c3c;">üåü Modalidad Exclusiva Premium üåü</h3>
            <div style="background: linear-gradient(45deg, #f39c12, #e67e22); color: white; padding: 20px; border-radius: 15px; margin: 20px 0; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.2);">
                <h4 style="margin: 0; font-size: 1.3em;">‚≠ê MODALIDAD PREMIUM ‚≠ê</h4>
                <p style="margin: 10px 0; font-size: 1.1em;">2 oportunidades de ganar por cada n√∫mero</p>
                <p style="margin: 0; font-size: 0.9em; opacity: 0.9;">¬°Duplica tus posibilidades de llevarte el gran premio!</p>
            </div>
        `;
        // Add deployment preparation
        console.log("Bingo Interactivo - Ready for deployment");

        // Ensure images load properly for deployment
        const images = document.querySelectorAll("img");
        images.forEach((img) => {
            img.onerror = function () {
                // Fallback to placeholder if images don't load
                this.style.background = this.alt.includes("Morral")
                    ? "linear-gradient(135deg, #8b4513, #d2691e)"
                    : "linear-gradient(135deg, #cd853f, #f4a460)";
                this.style.display = "flex";
                this.style.alignItems = "center";
                this.style.justifyContent = "center";
                this.style.color = "white";
                this.style.fontSize = "1em";
                this.style.textAlign = "center";
                this.innerHTML = this.alt;
            };
        });

        // Set premium as the only mode
        currentProbability = "premium";
    });

    // Override the setProbability function to always use premium
    function setProbability(prob) {
        currentProbability = "premium";
    }
</script>
